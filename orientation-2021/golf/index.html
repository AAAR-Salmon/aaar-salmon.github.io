<!DOCTYPE html>
<html lang="ja">

<head>
	<meta charset="utf-8">
	<title>OUCRC新歓2021/コードゴルフ大会</title>
</head>

<body>
	<h1>OUCRC新歓2021/コードゴルフ大会</h1>
	<details>
		<summary>開催期間</summary>
		2021/04/02 13:00:00 - 2021/04/30 23:59:59
	</details>
	<details>
		<summary>コードゴルフ概要</summary>
		コードゴルフとは与えられた条件を満たすコードをなるべく短く書くe-sportsです。
	</details>
	<details>
		<summary>評価方法</summary>
		<table>
			<thead>
				<tr>
					<th>サイト</th>
					<th>評価方法</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>AtCoder,yukicoder</td>
					<td>「結果」がACとなった提出の「コード長」</td>
				</tr>
			</tbody>
		</table>
	</details>
	<p>
		バックエンドは現在準備中です。問題一覧だけ置いておくのでぜひ解いてみてください。
	</p>
	<table>
		<thead>
			<tr>
				<th>問題</th>
				<th>基準スコア</th>
				<th>最高スコア</th>
				<th>提出者</th>
				<th>提出言語</th>
			</tr>
		</thead>
		<tbody id="leaderboard"></tbody>
	</table>

	<!-- The core Firebase JS SDK is always required and must be listed first -->
	<script src="https://www.gstatic.com/firebasejs/8.3.2/firebase-app.js"></script>
	
	<!-- TODO: Add SDKs for Firebase products that you want to use
				 https://firebase.google.com/docs/web/setup#available-libraries -->
	<script src="https://www.gstatic.com/firebasejs/8.3.2/firebase-analytics.js"></script>
	<script src="https://www.gstatic.com/firebasejs/8.3.0/firebase-firestore.js"></script>
	
	<script>
		// Your web app's Firebase configuration
		// For Firebase JS SDK v7.20.0 and later, measurementId is optional
		var firebaseConfig = {
			apiKey: "AIzaSyApSAjkIgvaVl1uuIb4ysU8yVIQ-eASIoc",
			authDomain: "salmon-githubio.firebaseapp.com",
			projectId: "salmon-githubio",
			storageBucket: "salmon-githubio.appspot.com",
			messagingSenderId: "909200478002",
			appId: "1:909200478002:web:c6a2c4c0ae70c1c833512b",
			measurementId: "G-KB84M5ZL7B"
		};
		// Initialize Firebase
		firebase.initializeApp(firebaseConfig);
		firebase.analytics();
		var db = firebase.firestore();

		var leaderboard = document.getElementById("leaderboard");
		var submissionsRef = db.collection("submissions");
		var problemsRef = db.collection("problems");
		for (id of ["a", "b", "c", "d", "e", "f", "g", "h", "i", "j"]) {
			problemsRef.where("id", "==", id).get().then(res => {
				return new Promise((resolve, reject) => {
					var prob = res.docs[0];
					resolve([prob.id, prob.data().title, prob.data().url]);
				});
			}).then(([probId, probTitle, probUrl]) => {
				submissionsRef.where("problem", "==", problemsRef.doc(probId)).get().then(res => {
					var shortest = null;
					if (res.docs.length > 0) {
						shortest = res.docs[0];
						res.forEach(doc => {
							if (doc.data().score < shortest.data().score) {
								shortest = doc;
							} else if (doc.data().score == shortest.data().score && doc.data().timestamp < shortest.data().timestamp) {
								shortest = doc;
							}
						});
					}
					
					var nodeRow = document.createElement("tr");
					// problem
					var nodeProbrem = document.createElement("td");
					var nodeProbremLink = document.createElement("a");
					var nodeProbremTitle = document.createTextNode(probTitle);
					nodeProbremLink.href = probUrl;
					nodeProbremLink.appendChild(nodeProbremTitle);
					nodeProbrem.appendChild(nodeProbremLink);
					nodeRow.appendChild(nodeProbrem);
					// par
					var nodePar = document.createElement("td");
					var nodeParScore = document.createTextNode("");
					nodePar.appendChild(nodeParScore);
					nodeRow.appendChild(nodePar);
					// shortest
					var nodeShortest = document.createElement("td");
					var nodeShortestScore = document.createTextNode("");
					nodeShortest.appendChild(nodeShortestScore);
					nodeRow.appendChild(nodeShortest);
					// contestant
					var nodeContestant = document.createElement("td");
					var nodeContestantName = document.createTextNode("");
					nodeContestant.appendChild(nodeContestantName);
					nodeRow.appendChild(nodeContestant);
					// language
					var nodeLanguage = document.createElement("td");
					var nodeLanguageName = document.createTextNode("");
					nodeLanguage.appendChild(nodeLanguageName);
					nodeRow.appendChild(nodeLanguage);

					if (shortest !== null) {
						nodeShortestScore.textContent = shortest.data().score;
						nodeContestantName.textContent = shortest.data().contestant;
						nodeLanguageName.textContent = shortest.data().language;
					}

					leaderboard.appendChild(nodeRow);
				});
			});
		}
	</script>
</body>

</html>
